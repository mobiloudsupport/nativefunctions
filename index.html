<html>
<head>
	<script type="text/javascript"> 
		// Check if the user agent matches the app's user agent
		const isApp = navigator.userAgent.toLowerCase().indexOf('canvas') > -1;

		// Add the event listener that will trigger once the native functions are ready to be used
		window.addEventListener("message", (event) => {
			runNativeFunctions(event);
		}, false);
		
		// Run when the event listener is triggered
		function runNativeFunctions(event) {
			try {
				if (isApp) {
				
					const data = event.data;
					const source = event.source;
					const origin = event.origin;
					let eventData = document.querySelector('.eventData');
					let eventSource = document.querySelector('.eventSource');
					let eventOrigin = document.querySelector('.eventOrigin');
					eventData.innerHTML = data;
					eventOrigin.innerHTML = origin;
					eventSource.innerHTML = source;
					
					if (event.data && event.data == 'nativeFunctionsLoaded') {
					
						// Set the external user ID
						let externalUserId = 1;
						let doesWork = document.querySelector('.doesWork');
						let app = document.querySelector('.inApp');
						
						app.innerHTML = "yes, we are in the app";
						
						nativeFunctions.onesignalSetExternalUserId(externalUserId);
						doesWork.innerHTML = "yes, the native function triggered successfully";
						
					}
				}	
			} catch (ex) {
			
				var span = document.getElementById('response');
				span.textContent = 'Error: ' + ex.message;
				console.log(span.textContent);
				doesWork.innerHTML = "no, something went wrong";
				
			}
			
		}
	</script>
</head>
<body>
 
	<h1>Are native functions working?</h1>
	<h3 class="doesWork">No</h3>
	<br /><br />
	
	<h1>Are we in the app?</h1>
	<h3 class="inApp">No</h3>
	<br /><br />
	
	<h3 class="eventData"></h3>
	<h3 class="eventSource"></h3>
	<h3 class="eventOrigin"></h3>
	
</body>
</html>